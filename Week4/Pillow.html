
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Pillow image processing &#8212; UC Irvine Math 9 Fall 2022 - Python portion</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Brief introduction to object-oriented programming" href="ObjectOriented.html" />
    <link rel="prev" title="Week 4" href="Week4-Intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/penguins-rev.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">UC Irvine Math 9 Fall 2022 - Python portion</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    UC Irvine, Math 9, Fall 2022, Python portion
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Week1/Week1-Intro.html">
   Week 1
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Week1/PythonDataTypes.html">
     Python data types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Week1/AlternatingList.html">
     Alternating list
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Week2/Week2-Intro.html">
   Week 2
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Week2/NumPy.html">
     NumPy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Week3/Week3-Intro.html">
   Week 3
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Week3/PythonicCode.html">
     Pythonic code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Week3/Matplotlib.html">
     Matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Week3/NewtonsMethod.html">
     Newton’s Method
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Week4-Intro.html">
   Week 4
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Pillow image processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ObjectOriented.html">
     Brief introduction to object-oriented programming
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ChristopherDavisUCI/UCI-Math-9-F22/main?urlpath=tree/Week4/Pillow.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/ChristopherDavisUCI/UCI-Math-9-F22"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Week4/Pillow.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#opening-an-image">
   Opening an image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#images-and-numpy-arrays">
   Images and NumPy arrays
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-colors">
   Setting colors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#making-an-image-from-scratch">
   Making an image from scratch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#swapping-two-color-channels">
   Swapping two color channels
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unique-colors">
   Unique colors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-colors-using-a-boolean-mask">
   Changing colors using a Boolean mask
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-colors-using-np-where">
   Changing colors using
   <code class="docutils literal notranslate">
    <span class="pre">
     np.where
    </span>
   </code>
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Pillow image processing</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#opening-an-image">
   Opening an image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#images-and-numpy-arrays">
   Images and NumPy arrays
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-colors">
   Setting colors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#making-an-image-from-scratch">
   Making an image from scratch
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#swapping-two-color-channels">
   Swapping two color channels
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unique-colors">
   Unique colors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-colors-using-a-boolean-mask">
   Changing colors using a Boolean mask
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-colors-using-np-where">
   Changing colors using
   <code class="docutils literal notranslate">
    <span class="pre">
     np.where
    </span>
   </code>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="pillow-image-processing">
<h1>Pillow image processing<a class="headerlink" href="#pillow-image-processing" title="Permalink to this headline">#</a></h1>
<p>In this notebook, we will see examples of image processing using the Pillow fork of the PIL library.  Image processing is interesting in its own right, but probably more importantly for Math 9, it provides a way to think about NumPy arrays in a visual way, including three-dimensional NumPy arrays.  (So far, we have only worked with one-dimensional and two-dimensional NumPy arrays, which we think of like vectors and matrices, respectively.)</p>
<section id="opening-an-image">
<h2>Opening an image<a class="headerlink" href="#opening-an-image" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/ltR6DSTPh-4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><p>Before you can import Numpy, you need to install NumPy.  Sounds obvious enough, but for the image processing library we will use, the procedure is slightly different.  See this video, but briefly, we install the library using the name Pillow and import it using the name PIL.</p>
<p>We will also import the <code class="docutils literal notranslate"><span class="pre">os</span></code> module (which is part of the standard Python library, so it does not need to be installed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
</div>
</div>
<p>We won’t do much with the Pillow library in this section, but here is a quick example of using Pillow to open an image file.  In order for this command to work as written, the penguins.jpg file needs to be in the same folder as your Jupyter notebook file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;penguins.jpg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_5_0.png" src="../_images/Pillow_5_0.png" />
</div>
</div>
<p>If there are many files you need to access, it is inconvenient to need to have them all in the same folder.  For the rest of this section, we will see some ways to use the <code class="docutils literal notranslate"><span class="pre">os</span></code> module to locate files.  (<a class="reference internal" href="ObjectOriented.html#pathlib"><span class="std std-ref">Later</span></a> we will briefly see a more modern, more object-oriented, approach to locating files, using the <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> module.)</p>
<p>As a first example involving <code class="docutils literal notranslate"><span class="pre">os</span></code>, we can use its <code class="docutils literal notranslate"><span class="pre">getcwd</span></code> function to learn the location of the current folder (i.e., the location of the folder that your Jupyter Notebook file is in).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/Users/christopherdavis/Documents/GitHub/UCI-Math-9-F22/Week4&#39;
</pre></div>
</div>
</div>
</div>
<p>Another useful <code class="docutils literal notranslate"><span class="pre">os</span></code> function is <code class="docutils literal notranslate"><span class="pre">listdir</span></code>, takes as input a string indicating a directory, and which returns a list of every file and directory in the input directory.  (I use the words “folder” and “directory” interchangeably.)  In the following, the string <code class="docutils literal notranslate"><span class="pre">&quot;images&quot;</span></code> doesn’t have any special meaning related to images; instead <code class="docutils literal notranslate"><span class="pre">&quot;images&quot;</span></code> is just the name of a subfolder of my current folder.  In this case, we can see that the images folder contains 8 files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;penguins.jpg&#39;,
 &#39;Seurat-var.png&#39;,
 &#39;Seurat-orig.jpg&#39;,
 &#39;altair.gif&#39;,
 &#39;Davis-Square2017.png&#39;,
 &#39;alphabet.png&#39;,
 &#39;flowchart.jpeg&#39;,
 &#39;test_grid.png&#39;]
</pre></div>
</div>
</div>
</div>
<p>If we don’t pass an argument to <code class="docutils literal notranslate"><span class="pre">listdir</span></code>, then the output is a list containing all the files and folders in the current folder.  For example, we see the name of this notebook, Pillow.ipynb.  We also see the images folder mentioned above.  We also see some “hidden” files (the ones that start with a period).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Draft-Week4.ipynb&#39;,
 &#39;Draft-Pillow.ipynb&#39;,
 &#39;penguins.jpg&#39;,
 &#39;.DS_Store&#39;,
 &#39;images&#39;,
 &#39;Pillow.ipynb&#39;,
 &#39;.ipynb_checkpoints&#39;,
 &#39;ObjectOriented.ipynb&#39;]
</pre></div>
</div>
</div>
</div>
<p>One of the files in the images folder was named “alphabet.png”.  Let’s try to open it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;alphabet.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [6],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;alphabet.png&quot;</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/math9f22/lib/python3.10/site-packages/PIL/Image.py:3092,</span> in <span class="ni">open</span><span class="nt">(fp, mode, formats)</span>
<span class="g g-Whitespace">   </span><span class="mi">3089</span>     <span class="n">filename</span> <span class="o">=</span> <span class="n">fp</span>
<span class="g g-Whitespace">   </span><span class="mi">3091</span> <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3092</span>     <span class="n">fp</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3093</span>     <span class="n">exclusive_fp</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">   </span><span class="mi">3095</span> <span class="k">try</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;alphabet.png&#39;
</pre></div>
</div>
</div>
</div>
<p>An error is raised because Pillow does not know where to find the alphabet.png file.  On my Mac, I could solve this by inputting <code class="docutils literal notranslate"><span class="pre">&quot;images/alphabet.png&quot;</span></code>, but if I instead were on a PC, I would have to input <code class="docutils literal notranslate"><span class="pre">&quot;images\alphabet.png&quot;</span></code>.  That is especially annoying if you are sharing code with someone on a different system.  Luckily, there is a function in <code class="docutils literal notranslate"><span class="pre">os.path</span></code> which will automatically choose the correct separator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="s2">&quot;alphabet.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;images/alphabet.png&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="s2">&quot;alphabet.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This variable <code class="docutils literal notranslate"><span class="pre">s</span></code> now specifies the path to the “alphabet.png” file, relative to our current location.  This path is what is needed to open the file using Pillow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_18_0.png" src="../_images/Pillow_18_0.png" />
</div>
</div>
<p>As a last example, let’s see two ways to find all the png files in the images folder.  Here is a reminder of all the files in that folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;penguins.jpg&#39;,
 &#39;Seurat-var.png&#39;,
 &#39;Seurat-orig.jpg&#39;,
 &#39;altair.gif&#39;,
 &#39;Davis-Square2017.png&#39;,
 &#39;alphabet.png&#39;,
 &#39;flowchart.jpeg&#39;,
 &#39;test_grid.png&#39;]
</pre></div>
</div>
</div>
</div>
<p>Both our approaches will involve list comprehension.  The first approach uses slicing, to indicate that we want all the strings whose last 3 characters are <code class="docutils literal notranslate"><span class="pre">&quot;png&quot;</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Seurat-var.png&#39;, &#39;Davis-Square2017.png&#39;, &#39;alphabet.png&#39;, &#39;test_grid.png&#39;]
</pre></div>
</div>
</div>
</div>
<p>The second approach uses the string method <code class="docutils literal notranslate"><span class="pre">endswith</span></code>.  I think both of these approaches have their advantages.  This <code class="docutils literal notranslate"><span class="pre">endswith</span></code> approach is nice because you don’t need to indicate the length of <code class="docutils literal notranslate"><span class="pre">&quot;png&quot;</span></code>.  The slicing approach is nice because you are more likely to know about slicing than to know about this very specific method <code class="docutils literal notranslate"><span class="pre">endswith</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;png&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Seurat-var.png&#39;, &#39;Davis-Square2017.png&#39;, &#39;alphabet.png&#39;, &#39;test_grid.png&#39;]
</pre></div>
</div>
</div>
</div>
<p>We haven’t done any image processing yet.  So far, we only used the Pillow library as an excuse to talk about working with files in Python.  In the rest of this notebook, we’ll work with the Pillow library much more closely.</p>
</section>
<section id="images-and-numpy-arrays">
<h2>Images and NumPy arrays<a class="headerlink" href="#images-and-numpy-arrays" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FwZAM56dqo4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>The Pillow library provides us with a visual way to work with NumPy arrays, which may help make some of the earlier topics more concrete.  For example, in this section we will see <em>slicing</em> in the context of Pillow images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>Above, we used <code class="docutils literal notranslate"><span class="pre">Image.open</span></code> to display an image in this Jupyter notebook.  That isn’t usually how we will use <code class="docutils literal notranslate"><span class="pre">Image.open</span></code>.  Usually we will save the resulting object, in this case, a <code class="docutils literal notranslate"><span class="pre">JpegImageFile</span></code>, so that we can perform image processing on it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;penguins.jpg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PIL.JpegImagePlugin.JpegImageFile
</pre></div>
</div>
</div>
</div>
<p>The object <code class="docutils literal notranslate"><span class="pre">img</span></code> itself is not a NumPy array, but it can be converted to a NumPy array.  There are a few different ways to make that conversion.  We might talk about the differences later, but for now we will use the recommended way, which is to use <code class="docutils literal notranslate"><span class="pre">np.asarray</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting object, <code class="docutils literal notranslate"><span class="pre">arr</span></code>, is a NumPy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy.ndarray
</pre></div>
</div>
</div>
</div>
<p>The actual <code class="docutils literal notranslate"><span class="pre">img</span></code> variable itself is unchaned; it’s still a Pillow Image object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_36_0.png" src="../_images/Pillow_36_0.png" />
</div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">arr</span></code> is a NumPy array, <code class="docutils literal notranslate"><span class="pre">arr</span></code> has all the usual attributes and methods of NumPy arrays.  For example, here is its <code class="docutils literal notranslate"><span class="pre">shape</span></code> attribute.  Notice that three different numbers are listed.  I believe this is our first example in Math 9 of a three-dimensional NumPy array.  The number <code class="docutils literal notranslate"><span class="pre">225</span></code> refers to the number of rows, the number <code class="docutils literal notranslate"><span class="pre">399</span></code> refers to the number of columns (notice that the image is wider than it is tall), and the number <code class="docutils literal notranslate"><span class="pre">3</span></code> refers to the RGB  (Red-Green-Blue) values which specify the color of a given pixel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(225, 399, 3)
</pre></div>
</div>
</div>
</div>
<p>Think of <code class="docutils literal notranslate"><span class="pre">arr</span></code> like a matrix with 225 rows and 399 columns.  Each entry in this “matrix” is not a single number, but is instead a triple of numbers representing the RGB values.  For example, the upper-left-most pixel has Red value of 178, Green value of 190, and Blue value of 206.  The bigger the number, the more of that color is present in the given pixel.  (For future reference, also notice that the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> is specified as <code class="docutils literal notranslate"><span class="pre">uint8</span></code>, which stands for <em>unsigned</em> 8-bit integers.  Later we will have to convert our own arrays to <code class="docutils literal notranslate"><span class="pre">dtype=np.uint8</span></code> so that Pillow can handle the data type.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([178, 190, 206], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>What does a number like <code class="docutils literal notranslate"><span class="pre">178</span></code> mean in this case?  Is that a big value?  Different normalizations are possible (using real numbers between 0 and 1 is another common choice of normalization), but the normalization Pillow uses is integer values from 0 (inclusive) to 256 (exclusive).  That means there are exactly 256 options for each value, which corresponds to 8 bits or to 1 byte.</p>
<p>When we evaluate <code class="docutils literal notranslate"><span class="pre">arr.min()</span></code>, NumPy goes through all <span class="math notranslate nohighlight">\(225 \cdot 399 \cdot 3\)</span> numbers in the array and checks what is the minimum value which occurs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>255
</pre></div>
</div>
</div>
</div>
<p>Here is an example of slicing in terms of the image.  Let’s get every row, and  the columns from 300-th to the right.  (And because we don’t specify a slice in the third dimension, in the RGB dimension, all of the RGB values will be included.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">300</span><span class="p">:])</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(225, 99, 3)
</pre></div>
</div>
</div>
</div>
<p>Here is a reminder of how our original image looked.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_47_0.png" src="../_images/Pillow_47_0.png" />
</div>
</div>
<p>We can convert from a NumPy array (as long as it has a suitable shape and <code class="docutils literal notranslate"><span class="pre">dtype</span></code>) to a Pillow Image using <code class="docutils literal notranslate"><span class="pre">Image.fromarray</span></code>.  Here we make a Pillow Image out of our sliced NumPy array.  Notice how it is the right-most portion of the image, but with every row, and with the colors unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">300</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_49_0.png" src="../_images/Pillow_49_0.png" />
</div>
</div>
</section>
<section id="setting-colors">
<h2>Setting colors<a class="headerlink" href="#setting-colors" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/n1t7HpZZxp8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>We’ve seen above how to get a portion of a Pillow Image.  Here we’ll see how to change part of that Image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;penguins.jpg&quot;</span><span class="p">)</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_53_0.png" src="../_images/Pillow_53_0.png" />
</div>
</div>
<p>Let’s say we want to change the horizontal band from row 100 to row 150 to the color black, which is represented in RGB values as <code class="docutils literal notranslate"><span class="pre">[0,0,0]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">150</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_55_0.png" src="../_images/Pillow_55_0.png" />
</div>
</div>
<p>The following almost works, but we get an error which says that <code class="docutils literal notranslate"><span class="pre">arr</span></code> is “read-only”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">Input In [5],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">arr</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="ne">ValueError</span>: assignment destination is read-only
</pre></div>
</div>
</div>
</div>
<p>To fix that, we can make a copy of <code class="docutils literal notranslate"><span class="pre">arr</span></code>, using the array’s <code class="docutils literal notranslate"><span class="pre">copy</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To understand a fundamental difference between <code class="docutils literal notranslate"><span class="pre">arr</span></code> and its copy <code class="docutils literal notranslate"><span class="pre">B</span></code>, let’s look at the size of these two objects.  Not the size in terms of pixels, but the size in terms of how much space they take up in memory.  We will use the <code class="docutils literal notranslate"><span class="pre">sys</span></code> module, which is part of the Python standard library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
</pre></div>
</div>
</div>
</div>
<p>The following represents the size of <code class="docutils literal notranslate"><span class="pre">img</span></code> in bytes.  Notice how small it is, even though the picture itself looks relatively high-quality.  The size of <code class="docutils literal notranslate"><span class="pre">img</span></code> is significantly less than even a kilobyte.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>48
</pre></div>
</div>
</div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">arr</span></code> also is very small in relation to how much data it seems to hold; it is only 144 bytes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>144
</pre></div>
</div>
</div>
</div>
<p>For comparison, the copy we made, <code class="docutils literal notranslate"><span class="pre">B</span></code>, is over two-hundred thousand bytes.  The fundamental difference between <code class="docutils literal notranslate"><span class="pre">img</span></code> and <code class="docutils literal notranslate"><span class="pre">arr</span></code> on one hand, and <code class="docutils literal notranslate"><span class="pre">B</span></code> on the other hand, is that <code class="docutils literal notranslate"><span class="pre">img</span></code> and <code class="docutils literal notranslate"><span class="pre">arr</span></code> are only keeping track of where to get data from on the computer (like the location of the image file with the data), whereas <code class="docutils literal notranslate"><span class="pre">B</span></code> is actually holding a copy of all of that data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>269469
</pre></div>
</div>
</div>
</div>
<p>So <code class="docutils literal notranslate"><span class="pre">B</span></code> takes up thousands of times more space than <code class="docutils literal notranslate"><span class="pre">arr</span></code>, but the benefit of <code class="docutils literal notranslate"><span class="pre">B</span></code> is that <code class="docutils literal notranslate"><span class="pre">B</span></code> is not read-only.  Because <code class="docutils literal notranslate"><span class="pre">B</span></code> is not read-only, the following assignment works without raising an error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>We have now changed many of the pixels in <code class="docutils literal notranslate"><span class="pre">B</span></code> to correspond to black.  We can view the image corresponding to <code class="docutils literal notranslate"><span class="pre">B</span></code> using <code class="docutils literal notranslate"><span class="pre">Image.fromarray</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_71_0.png" src="../_images/Pillow_71_0.png" />
</div>
</div>
<p>Setting the color to white is almost identical.  White corresponds to the maximum value in each of the red, the green, and the blue slots.  Under Pillow’s normalization, this maximum value is <code class="docutils literal notranslate"><span class="pre">255</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_74_0.png" src="../_images/Pillow_74_0.png" />
</div>
</div>
<p>Let’s next try to set the color of this horizontal band to green, which corresponds in RGB values to <code class="docutils literal notranslate"><span class="pre">[0,255,0]</span></code>.  In order to make this assignment, let’s recall the rules of broadcasting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(50, 399, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">color</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3,)
</pre></div>
</div>
</div>
</div>
<p>The shapes of <code class="docutils literal notranslate"><span class="pre">B[100:150]</span></code> and <code class="docutils literal notranslate"><span class="pre">color</span></code> are compatible with respect to broadcasting if, starting from the right-most dimension, the dimension sizes are either equal, or one of those dimensions is equal to 1.  In this case, the right-most dimensions of <code class="docutils literal notranslate"><span class="pre">B[100:150]</span></code> and <code class="docutils literal notranslate"><span class="pre">color</span></code> are both equal to <code class="docutils literal notranslate"><span class="pre">3</span></code>, and because <code class="docutils literal notranslate"><span class="pre">color</span></code> has no further dimensions, these shapes are compatible.</p>
<p>The following command is setting each of the 50 times 399 pixels in this horizontal band to be green.  The only reason this assignment works is because the shapes of <code class="docutils literal notranslate"><span class="pre">B[100:150]</span></code> and <code class="docutils literal notranslate"><span class="pre">color</span></code> are compatible with respect to broadcasting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_81_0.png" src="../_images/Pillow_81_0.png" />
</div>
</div>
</section>
<section id="making-an-image-from-scratch">
<h2>Making an image from scratch<a class="headerlink" href="#making-an-image-from-scratch" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/KhkhWZIwvdY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>So far we’ve gone from an image to a NumPy array, and then we’ve made changes to the NumPy array and displayed the resulting image.  Here we are going to start with a NumPy array and try to turn that into a Pillow Image object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>View the following as corresponding to a 2-pixel by 2-pixel image.  The top-left pixel will be red, the top-right pixel will be green, and the lower-left pixel will be blue.  It’s not as clear what color the lower-right pixel should be, but that pixel will be maximum red and maximum green combined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">]]])</span>
</pre></div>
</div>
</div>
</div>
<p>When we try to convert <code class="docutils literal notranslate"><span class="pre">arr</span></code> to a Pillow Image, we get the following error.  I get this error all the time when I try to make a Pillow image from scratch (as opposed to starting with a Pillow image and editing it).  The error is telling us that the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> is incorrect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">File ~/miniconda3/envs/math9f22/lib/python3.10/site-packages/PIL/Image.py:2953,</span> in <span class="ni">fromarray</span><span class="nt">(obj, mode)</span>
<span class="g g-Whitespace">   </span><span class="mi">2952</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2953</span>     <span class="n">mode</span><span class="p">,</span> <span class="n">rawmode</span> <span class="o">=</span> <span class="n">_fromarray_typemap</span><span class="p">[</span><span class="n">typekey</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2954</span> <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">KeyError</span>: ((1, 1, 3), &#39;&lt;i8&#39;)

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [3],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/math9f22/lib/python3.10/site-packages/PIL/Image.py:2955,</span> in <span class="ni">fromarray</span><span class="nt">(obj, mode)</span>
<span class="g g-Whitespace">   </span><span class="mi">2953</span>         <span class="n">mode</span><span class="p">,</span> <span class="n">rawmode</span> <span class="o">=</span> <span class="n">_fromarray_typemap</span><span class="p">[</span><span class="n">typekey</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2954</span>     <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2955</span>         <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot handle this data type: </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">typekey</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">   </span><span class="mi">2956</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2957</span>     <span class="n">rawmode</span> <span class="o">=</span> <span class="n">mode</span>

<span class="ne">TypeError</span>: Cannot handle this data type: (1, 1, 3), &lt;i8
</pre></div>
</div>
</div>
</div>
<p>We saw above that when we load an image from a file and convert it to a NumPy array, the resulting <code class="docutils literal notranslate"><span class="pre">dtype</span></code> is unsigned 8-bit integers.  We’ll explicitly make our NumPy array have that <code class="docutils literal notranslate"><span class="pre">dtype</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now successfully convert this NumPy array to a Pillow Image, but because it is only four total pixels, the resulting image is tiny.  If you zoom in on the following output, maybe you can see the four pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_91_0.png" src="../_images/Pillow_91_0.png" />
</div>
</div>
<p>Instead of just displaying the Image, let’s assign it to the variable name <code class="docutils literal notranslate"><span class="pre">img</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Pillow Image objects have a <code class="docutils literal notranslate"><span class="pre">resize</span></code> method that can be used in this case.  We call <code class="docutils literal notranslate"><span class="pre">resize</span></code> with the argument <code class="docutils literal notranslate"><span class="pre">(100,100)</span></code>, which will be the size of the resulting Image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_95_0.png" src="../_images/Pillow_95_0.png" />
</div>
</div>
<p>The only thing I don’t like about the above is the blurry transitions between the colors.  I would rather it just use 50-by-50 pixels of red, 50-by-50 pixels of green, and so on.  If we check the documentation for <code class="docutils literal notranslate"><span class="pre">img.resize</span></code>, we see that there is a <code class="docutils literal notranslate"><span class="pre">resample</span></code> keyword argument which can be used to influence these transitions.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on method resize in module PIL.Image:

resize(size, resample=None, box=None, reducing_gap=None) method of PIL.Image.Image instance
    Returns a resized copy of this image.
    
    :param size: The requested size in pixels, as a 2-tuple:
       (width, height).
    :param resample: An optional resampling filter.  This can be
       one of :py:data:`PIL.Image.Resampling.NEAREST`,
       :py:data:`PIL.Image.Resampling.BOX`,
       :py:data:`PIL.Image.Resampling.BILINEAR`,
       :py:data:`PIL.Image.Resampling.HAMMING`,
       :py:data:`PIL.Image.Resampling.BICUBIC` or
       :py:data:`PIL.Image.Resampling.LANCZOS`.
       If the image has mode &quot;1&quot; or &quot;P&quot;, it is always set to
       :py:data:`PIL.Image.Resampling.NEAREST`.
       If the image mode specifies a number of bits, such as &quot;I;16&quot;, then the
       default filter is :py:data:`PIL.Image.Resampling.NEAREST`.
       Otherwise, the default filter is
       :py:data:`PIL.Image.Resampling.BICUBIC`. See: :ref:`concept-filters`.
    :param box: An optional 4-tuple of floats providing
       the source image region to be scaled.
       The values must be within (0, 0, width, height) rectangle.
       If omitted or None, the entire source is used.
    :param reducing_gap: Apply optimization by resizing the image
       in two steps. First, reducing the image by integer times
       using :py:meth:`~PIL.Image.Image.reduce`.
       Second, resizing using regular resampling. The last step
       changes size no less than by ``reducing_gap`` times.
       ``reducing_gap`` may be None (no first step is performed)
       or should be greater than 1.0. The bigger ``reducing_gap``,
       the closer the result to the fair resampling.
       The smaller ``reducing_gap``, the faster resizing.
       With ``reducing_gap`` greater or equal to 3.0, the result is
       indistinguishable from fair resampling in most cases.
       The default value is None (no optimization).
    :returns: An :py:class:`~PIL.Image.Image` object.
</pre></div>
</div>
</div>
</div>
<p>In the above documentation, notice that the resampling options all have names like <code class="docutils literal notranslate"><span class="pre">PIL.Image.Resampling.LANCZOS</span></code>.  This means that for example <code class="docutils literal notranslate"><span class="pre">LANCZOS</span></code> is an attribute of <code class="docutils literal notranslate"><span class="pre">PIL.Image.Resampling</span></code>.  (We have already imported <code class="docutils literal notranslate"><span class="pre">Image</span></code> from <code class="docutils literal notranslate"><span class="pre">PIL</span></code>, so we would just call this <code class="docutils literal notranslate"><span class="pre">Image.Resampling</span></code> instead of <code class="docutils literal notranslate"><span class="pre">PIL.Image.Resampling</span></code>.)  We can view all of the attributes using Python’s <code class="docutils literal notranslate"><span class="pre">dir</span></code> function.</p>
<p>It’s hard to predict how many attributes there will be, but in this case, there are just the values we saw in the documentation, together with some so-called “dunder” methods (short for “double underscore”, because the names have two underscores at the beginning and at the end).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;BICUBIC&#39;,
 &#39;BILINEAR&#39;,
 &#39;BOX&#39;,
 &#39;HAMMING&#39;,
 &#39;LANCZOS&#39;,
 &#39;NEAREST&#39;,
 &#39;__class__&#39;,
 &#39;__doc__&#39;,
 &#39;__members__&#39;,
 &#39;__module__&#39;]
</pre></div>
</div>
</div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">dir</span></code> is a list, and here we iterate through the elements in the list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BICUBIC
BILINEAR
BOX
HAMMING
LANCZOS
NEAREST
__class__
__doc__
__members__
__module__
</pre></div>
</div>
</div>
</div>
<p>Here we are only interested in the attributes that do not start with an underscore.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BICUBIC
BILINEAR
BOX
HAMMING
LANCZOS
NEAREST
</pre></div>
</div>
</div>
</div>
<p>It would be tempting to use notation like <code class="docutils literal notranslate"><span class="pre">resample=Image.Resampling.s</span></code>, but how would Python know that this <code class="docutils literal notranslate"><span class="pre">s</span></code> is a variable and not a string?  We want to use something like f-strings, but we don’t have a string in this case, so f-strings will not work with this approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BICUBIC
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">Input In [12],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">display</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/math9f22/lib/python3.10/enum.py:437,</span> in <span class="ni">EnumMeta.__getattr__</span><span class="nt">(cls, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">435</span>     <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">436</span> <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">437</span>     <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

<span class="ne">AttributeError</span>: s
</pre></div>
</div>
</div>
</div>
<p>One option, that I think will always work, is to use Python’s built-in <code class="docutils literal notranslate"><span class="pre">getattr</span></code> function (short for “get attribute”).  Here we can see the effect of each of these resampling options.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">,</span> <span class="n">s</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BICUBIC
</pre></div>
</div>
<img alt="../_images/Pillow_107_1.png" src="../_images/Pillow_107_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BILINEAR
</pre></div>
</div>
<img alt="../_images/Pillow_107_3.png" src="../_images/Pillow_107_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BOX
</pre></div>
</div>
<img alt="../_images/Pillow_107_5.png" src="../_images/Pillow_107_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HAMMING
</pre></div>
</div>
<img alt="../_images/Pillow_107_7.png" src="../_images/Pillow_107_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LANCZOS
</pre></div>
</div>
<img alt="../_images/Pillow_107_9.png" src="../_images/Pillow_107_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NEAREST
</pre></div>
</div>
<img alt="../_images/Pillow_107_11.png" src="../_images/Pillow_107_11.png" />
</div>
</div>
<p>Another approach, that I think is more natural in this case, but which I think will not always work, is to use indexing notation, as in <code class="docutils literal notranslate"><span class="pre">resample=Image.Resampling[s]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="p">[</span><span class="n">s</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BICUBIC
</pre></div>
</div>
<img alt="../_images/Pillow_109_1.png" src="../_images/Pillow_109_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BILINEAR
</pre></div>
</div>
<img alt="../_images/Pillow_109_3.png" src="../_images/Pillow_109_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BOX
</pre></div>
</div>
<img alt="../_images/Pillow_109_5.png" src="../_images/Pillow_109_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HAMMING
</pre></div>
</div>
<img alt="../_images/Pillow_109_7.png" src="../_images/Pillow_109_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LANCZOS
</pre></div>
</div>
<img alt="../_images/Pillow_109_9.png" src="../_images/Pillow_109_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NEAREST
</pre></div>
</div>
<img alt="../_images/Pillow_109_11.png" src="../_images/Pillow_109_11.png" />
</div>
</div>
</section>
<section id="swapping-two-color-channels">
<h2>Swapping two color channels<a class="headerlink" href="#swapping-two-color-channels" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pANMhOx_22M" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Here is our goal in this section:</p>
<ul class="simple">
<li><p>Swap the green and blue color channels of the penguins image.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;penguins.jpg&quot;</span><span class="p">)</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here is a reminder of what <code class="docutils literal notranslate"><span class="pre">arr</span></code> contains.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[178, 190, 206],
        [178, 190, 206],
        [178, 190, 206],
        ...,
        [121, 137, 171],
        [121, 137, 171],
        [121, 137, 171]],

       [[179, 191, 207],
        [179, 191, 207],
        [179, 191, 207],
        ...,
        [120, 136, 170],
        [120, 136, 170],
        [119, 135, 169]],

       [[179, 191, 207],
        [179, 191, 207],
        [179, 191, 207],
        ...,
        [119, 135, 169],
        [118, 134, 168],
        [117, 133, 167]],

       ...,

       [[225, 226, 231],
        [224, 225, 230],
        [222, 223, 228],
        ...,
        [ 46,  46,  58],
        [ 64,  67,  82],
        [ 80,  85, 104]],

       [[222, 223, 228],
        [222, 223, 228],
        [218, 219, 224],
        ...,
        [ 54,  56,  69],
        [ 55,  58,  75],
        [108, 115, 134]],

       [[215, 218, 225],
        [209, 212, 219],
        [196, 199, 206],
        ...,
        [ 75,  77,  89],
        [100, 108, 121],
        [127, 139, 155]]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>Let’s just think about the upper-left pixel, and trying to swap its green and blue channels.  (For simplicity we will consider the list version of this length-3 NumPy array.)  Here is a common beginning programming mistake.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">178</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">206</span><span class="p">]</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The problem of course is that <code class="docutils literal notranslate"><span class="pre">190</span></code>, corresponding to <code class="docutils literal notranslate"><span class="pre">mylist[1]</span></code>, gets lost when we execute the line <code class="docutils literal notranslate"><span class="pre">mylist[1]</span> <span class="pre">=</span> <span class="pre">mylist[2]</span></code>, and there is no way to recover it.  So we wind up with the number <code class="docutils literal notranslate"><span class="pre">206</span></code> repeated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mylist</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[178, 206, 206]
</pre></div>
</div>
</div>
</div>
<p>Here is what I think of as the standard solution to that error: we store <code class="docutils literal notranslate"><span class="pre">mylist[1]</span></code> in a temporary variable, so the value doesn’t get lost when we execute the line <code class="docutils literal notranslate"><span class="pre">mylist[1]</span> <span class="pre">=</span> <span class="pre">mylist[2]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">178</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">206</span><span class="p">]</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
</pre></div>
</div>
</div>
</div>
<p>Here we can see that we did successfully swap the green and blue channels for this pixel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mylist</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[178, 206, 190]
</pre></div>
</div>
</div>
</div>
<p>Let’s try to emulate that strategy for the entire NumPy array. If we want the green channel from every row and every column, we can use <code class="docutils literal notranslate"><span class="pre">arr[:,:,1]</span></code>.  We store those green values in a temporary variable, and use the same procedure as above.</p>
<p>The first mistake is trying to make assignments to <code class="docutils literal notranslate"><span class="pre">arr</span></code>.  The line <code class="docutils literal notranslate"><span class="pre">temp</span> <span class="pre">=</span> <span class="pre">arr[:,:,1]</span></code> is fine, but the next line <code class="docutils literal notranslate"><span class="pre">arr[:,:,1]</span> <span class="pre">=</span> <span class="pre">arr[:,:,2]</span></code> raises an error.  Because <code class="docutils literal notranslate"><span class="pre">arr</span></code> is read-only, we need to use its copy <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">arr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">arr</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">Input In [9],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">B</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

<span class="ne">ValueError</span>: assignment destination is read-only
</pre></div>
</div>
</div>
</div>
<p>We now replace <code class="docutils literal notranslate"><span class="pre">arr</span></code> with <code class="docutils literal notranslate"><span class="pre">B</span></code>, but there is a very subtle error.  It would be very difficult to predict this error in advance (it is related to how Python and/or NumPy handle variable assignments).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">B</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">B</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
</pre></div>
</div>
</div>
</div>
<p>If we look at the upper-left-most pixel, we see the exact same issue as we saw above in the list version, even though it seems like we already applied the fix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([178, 206, 206], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>As a hint of what’s wrong, let’s look at the size in memory of <code class="docutils literal notranslate"><span class="pre">temp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">getsizeof</span>
</pre></div>
</div>
</div>
</div>
<p>We see that <code class="docutils literal notranslate"><span class="pre">temp</span></code> is <code class="docutils literal notranslate"><span class="pre">128</span></code> bytes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">getsizeof</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>128
</pre></div>
</div>
</div>
</div>
<p>Here is the contents of <code class="docutils literal notranslate"><span class="pre">temp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[206, 206, 206, ..., 171, 171, 171],
       [207, 207, 207, ..., 170, 170, 169],
       [207, 207, 207, ..., 169, 168, 167],
       ...,
       [231, 230, 228, ...,  58,  82, 104],
       [228, 228, 224, ...,  69,  75, 134],
       [225, 219, 206, ...,  89, 121, 155]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>And here is the <code class="docutils literal notranslate"><span class="pre">shape</span></code> of <code class="docutils literal notranslate"><span class="pre">temp</span></code>.  Does it really seem like a 225-by-399 array of integers can be stored in 128 bytes?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(225, 399)
</pre></div>
</div>
</div>
</div>
<p>The issue is that, when we evaluate <code class="docutils literal notranslate"><span class="pre">temp</span> <span class="pre">=</span> <span class="pre">B[:,:,1]</span></code>, the contents of <code class="docutils literal notranslate"><span class="pre">B[:,:,1]</span></code> do not get copied over to <code class="docutils literal notranslate"><span class="pre">temp</span></code>.  Instead, <code class="docutils literal notranslate"><span class="pre">temp</span></code> only remembers the location of where it should get its contents.  This can be convenient when working with very large NumPy arrays, but in this case, it breaks our code, because the assignment <code class="docutils literal notranslate"><span class="pre">B[:,:,1]</span> <span class="pre">=</span> <span class="pre">B[:,:,2]</span></code> not only changes <code class="docutils literal notranslate"><span class="pre">B[:,:,1]</span></code>, but also changes <code class="docutils literal notranslate"><span class="pre">temp</span></code>.</p>
<p>One flexible work-around is to call the <code class="docutils literal notranslate"><span class="pre">copy</span></code> method on <code class="docutils literal notranslate"><span class="pre">B[:,:,1]</span></code>, so that its contents get copied over to <code class="docutils literal notranslate"><span class="pre">temp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">B</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">B</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
</pre></div>
</div>
</div>
</div>
<p>Notice how, in this case, <code class="docutils literal notranslate"><span class="pre">B[0,0]</span></code>, representing the upper-left-most pixel, really does have three different channel values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([178, 206, 190], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>I think the above solution is the most general and most enlightening.  In our very particular situation, there is probably a simpler solution, due to the fact that we already have a copy of all the values saved, in the NumPy array <code class="docutils literal notranslate"><span class="pre">arr</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">B</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">B</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Here we get the same upper-left-most pixel as in our <code class="docutils literal notranslate"><span class="pre">copy</span></code> solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([178, 206, 190], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>To end this section, we will see how the image changes when its green and blue color channels are swapped.</p>
<p>Here is the original image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_146_0.png" src="../_images/Pillow_146_0.png" />
</div>
</div>
<p>Here is the new image.  Notice how the blue colors have been replaced by green colors.  What other changes do you notice?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_148_0.png" src="../_images/Pillow_148_0.png" />
</div>
</div>
</section>
<section id="unique-colors">
<h2>Unique colors<a class="headerlink" href="#unique-colors" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FNCSlsu5coE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>In this section, we will count the number of unique colors in an image.  As usual, the point is not the importance of the image processing technique.  Instead, the point is to practice with NumPy (in this case, the NumPy function <code class="docutils literal notranslate"><span class="pre">unique</span></code> together with an <code class="docutils literal notranslate"><span class="pre">axis</span></code> keyword argument).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>The penguins image we were working with above has thousands of colors.  Here we will work with a simpler image, that has just three colors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;images/test_grid.png&quot;</span><span class="p">)</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It looks like there are only three colors in this image, but sometimes there are many more colors than you would expect, especially at the boundary between colors.  In this case, we’ll verify that there indeed exactly three colors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_154_0.png" src="../_images/Pillow_154_0.png" />
</div>
</div>
<p>Even though this is a simpler image than the penguins photograph above, this grid is a significantly bigger image, in terms of pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2000, 2000, 3)
</pre></div>
</div>
</div>
</div>
<p>If we look at the corresponding NumPy array, we see that the very top row of pixels begins with three pixels with RGB values <code class="docutils literal notranslate"><span class="pre">[180,</span> <span class="pre">153,</span> <span class="pre">12]</span></code> and ends with three pixels with RGB values <code class="docutils literal notranslate"><span class="pre">[12,</span> <span class="pre">153,</span> <span class="pre">152]</span></code>.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       [[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       [[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       ...,

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]],

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]],

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>The function we want to use is <code class="docutils literal notranslate"><span class="pre">np.unique</span></code>, but if we call that function directly on <code class="docutils literal notranslate"><span class="pre">arr</span></code>, we will learn how many unique numbers appear in <code class="docutils literal notranslate"><span class="pre">arr</span></code>, whereas we want to know how many unique RGB triples of numbers occur.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 12, 152, 153, 180], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>The first step to applying <code class="docutils literal notranslate"><span class="pre">np.unique</span></code> successfully in this context is to reshape the array so it is two-dimensional, and with each row corresponding to a single RGB value that occurs in the image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For example, at the top of <code class="docutils literal notranslate"><span class="pre">B</span></code>, we see the same RGB values that we noticed in the original three-dimensional NumPy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[180, 153,  12],
       [180, 153,  12],
       [180, 153,  12],
       ...,
       [180, 153,  12],
       [180, 153,  12],
       [180, 153,  12]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>Recall that <code class="docutils literal notranslate"><span class="pre">arr</span></code> was size <span class="math notranslate nohighlight">\(2000 \times 2000 \times 3\)</span>.  After reshaping, <code class="docutils literal notranslate"><span class="pre">B</span></code> has size <span class="math notranslate nohighlight">\(4000000 \times 3\)</span>.  (One way to think about it is, we don’t care about what rows and columns the pixels are in; all we care about are what are the different colors of pixels that occur.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4000000, 3)
</pre></div>
</div>
</div>
</div>
<p>If we call <code class="docutils literal notranslate"><span class="pre">np.unique(B)</span></code>, we get the exact same result as <code class="docutils literal notranslate"><span class="pre">np.unique(arr)</span></code>.  If we don’t specify an <code class="docutils literal notranslate"><span class="pre">axis</span></code> keyword argument to <code class="docutils literal notranslate"><span class="pre">np.unique</span></code>, then the shape of the input array does not matter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 12, 152, 153, 180], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>The key is to call the <code class="docutils literal notranslate"><span class="pre">unique</span></code> function with <code class="docutils literal notranslate"><span class="pre">axis=0</span></code>.  This is saying, compare all of the rows to each other, and keep one copy of each unique row.  (How I think about it, is that we are changing the 0-axis, the rows axis.)  In this case, we are going from 4 million rows to 3 rows (corresponding to 3 colors).  We can see that the 0-dimension is changing, because <code class="docutils literal notranslate"><span class="pre">B.shape[0]</span></code> is <code class="docutils literal notranslate"><span class="pre">4000000</span></code> while <code class="docutils literal notranslate"><span class="pre">C.shape[0]</span></code> is <code class="docutils literal notranslate"><span class="pre">3</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">B.shape[1]</span></code> and <code class="docutils literal notranslate"><span class="pre">C.shape[1]</span></code> are both <code class="docutils literal notranslate"><span class="pre">3</span></code>, so the 1-dimension or the columns dimension is not changing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3, 3)
</pre></div>
</div>
</div>
</div>
<p>From <code class="docutils literal notranslate"><span class="pre">C</span></code> we can confirm our suspicion that there were exactly three colors in our grid image.  We had already seen two of these RGB triples, and the last one reported, <code class="docutils literal notranslate"><span class="pre">[12,</span> <span class="pre">12,</span> <span class="pre">12]</span></code>, is very close to black, <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">0]</span></code>, so that is the dark color that is used for writing the letters and numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 12,  12,  12],
       [ 12, 153, 152],
       [180, 153,  12]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>We can tell that the colors change between <code class="docutils literal notranslate"><span class="pre">[12,</span> <span class="pre">153,</span> <span class="pre">152]</span></code> and <code class="docutils literal notranslate"><span class="pre">[180,</span> <span class="pre">153,</span> <span class="pre">12]</span></code> at very regular intervals.  For the rest of this section, our goal is to determine where these changes occur.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_175_0.png" src="../_images/Pillow_175_0.png" />
</div>
</div>
<p>It suffices to just look at the very top-most row.  If we know where the colors change in the top row, we will also know where they change in every row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[180, 153,  12],
       [180, 153,  12],
       [180, 153,  12],
       ...,
       [ 12, 153, 152],
       [ 12, 153, 152],
       [ 12, 153, 152]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>The shape of the top row is <span class="math notranslate nohighlight">\(2000 \times 3\)</span>, which represents 2000 pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2000, 3)
</pre></div>
</div>
</div>
</div>
<p>A first guess for how to check the colors is to evaluate the following, but the <code class="docutils literal notranslate"><span class="pre">==</span></code> is getting broadcast.  For example, here we intended that <code class="docutils literal notranslate"><span class="pre">[180,</span> <span class="pre">153,</span> <span class="pre">12]</span> <span class="pre">==</span> <span class="pre">[12,</span> <span class="pre">153,</span> <span class="pre">152]</span></code> would evaluate to <code class="docutils literal notranslate"><span class="pre">False</span></code>, since the triples are not equal, but because of broadcasting, this is evaluating to <code class="docutils literal notranslate"><span class="pre">[False,</span> <span class="pre">True,</span> <span class="pre">False]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">152</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[False,  True, False],
       [False,  True, False],
       [False,  True, False],
       ...,
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True]])
</pre></div>
</div>
</div>
</div>
<p>The trick is to then apply <code class="docutils literal notranslate"><span class="pre">all(axis=1)</span></code>.  For example, this will convert <code class="docutils literal notranslate"><span class="pre">[False,</span> <span class="pre">True,</span> <span class="pre">False]</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> and this will convert <code class="docutils literal notranslate"><span class="pre">[True,</span> <span class="pre">True,</span> <span class="pre">True]</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.  (You might have expected us to use <code class="docutils literal notranslate"><span class="pre">axis=2</span></code>, because the RGB channels usually live in the third-dimension, but remember that we are only looking at the top row of pixels, so we have cut down the dimension by one.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">152</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([False, False, False, ...,  True,  True,  True])
</pre></div>
</div>
</div>
</div>
<p>As a sign that this is working correctly, if we check the <code class="docutils literal notranslate"><span class="pre">shape</span></code> of this Boolean array, we get that it is a one-dimensional NumPy array of length 2000.  This is as we expected, because it represents the 2000 pixels in the top row of the image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">152</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2000,)
</pre></div>
</div>
</div>
</div>
<p>Let’s save this length-2000 Boolean array as <code class="docutils literal notranslate"><span class="pre">BM</span></code>, for “Boolean Mask”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BM</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">152</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Where does <code class="docutils literal notranslate"><span class="pre">BM</span></code> switch from <code class="docutils literal notranslate"><span class="pre">False</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>?  As a first step, let’s just check where it is <code class="docutils literal notranslate"><span class="pre">True</span></code>.  We can find those indices by using <code class="docutils literal notranslate"><span class="pre">np.nonzero</span></code>.  Recall that <code class="docutils literal notranslate"><span class="pre">np.nonzero</span></code> returns a tuple.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">BM</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([ 200,  201,  202,  203,  204,  205,  206,  207,  208,  209,  210,
         211,  212,  213,  214,  215,  216,  217,  218,  219,  220,  221,
         222,  223,  224,  225,  226,  227,  228,  229,  230,  231,  232,
         233,  234,  235,  236,  237,  238,  239,  240,  241,  242,  243,
         244,  245,  246,  247,  248,  249,  250,  251,  252,  253,  254,
         255,  256,  257,  258,  259,  260,  261,  262,  263,  264,  265,
         266,  267,  268,  269,  270,  271,  272,  273,  274,  275,  276,
         277,  278,  279,  280,  281,  282,  283,  284,  285,  286,  287,
         288,  289,  290,  291,  292,  293,  294,  295,  296,  297,  298,
         299,  300,  301,  302,  303,  304,  305,  306,  307,  308,  309,
         310,  311,  312,  313,  314,  315,  316,  317,  318,  319,  320,
         321,  322,  323,  324,  325,  326,  327,  328,  329,  330,  331,
         332,  333,  334,  335,  336,  337,  338,  339,  340,  341,  342,
         343,  344,  345,  346,  347,  348,  349,  350,  351,  352,  353,
         354,  355,  356,  357,  358,  359,  360,  361,  362,  363,  364,
         365,  366,  367,  368,  369,  370,  371,  372,  373,  374,  375,
         376,  377,  378,  379,  380,  381,  382,  383,  384,  385,  386,
         387,  388,  389,  390,  391,  392,  393,  394,  395,  396,  397,
         398,  399,  600,  601,  602,  603,  604,  605,  606,  607,  608,
         609,  610,  611,  612,  613,  614,  615,  616,  617,  618,  619,
         620,  621,  622,  623,  624,  625,  626,  627,  628,  629,  630,
         631,  632,  633,  634,  635,  636,  637,  638,  639,  640,  641,
         642,  643,  644,  645,  646,  647,  648,  649,  650,  651,  652,
         653,  654,  655,  656,  657,  658,  659,  660,  661,  662,  663,
         664,  665,  666,  667,  668,  669,  670,  671,  672,  673,  674,
         675,  676,  677,  678,  679,  680,  681,  682,  683,  684,  685,
         686,  687,  688,  689,  690,  691,  692,  693,  694,  695,  696,
         697,  698,  699,  700,  701,  702,  703,  704,  705,  706,  707,
         708,  709,  710,  711,  712,  713,  714,  715,  716,  717,  718,
         719,  720,  721,  722,  723,  724,  725,  726,  727,  728,  729,
         730,  731,  732,  733,  734,  735,  736,  737,  738,  739,  740,
         741,  742,  743,  744,  745,  746,  747,  748,  749,  750,  751,
         752,  753,  754,  755,  756,  757,  758,  759,  760,  761,  762,
         763,  764,  765,  766,  767,  768,  769,  770,  771,  772,  773,
         774,  775,  776,  777,  778,  779,  780,  781,  782,  783,  784,
         785,  786,  787,  788,  789,  790,  791,  792,  793,  794,  795,
         796,  797,  798,  799, 1000, 1001, 1002, 1003, 1004, 1005, 1006,
        1007, 1008, 1009, 1010, 1011, 1012, 1013, 1014, 1015, 1016, 1017,
        1018, 1019, 1020, 1021, 1022, 1023, 1024, 1025, 1026, 1027, 1028,
        1029, 1030, 1031, 1032, 1033, 1034, 1035, 1036, 1037, 1038, 1039,
        1040, 1041, 1042, 1043, 1044, 1045, 1046, 1047, 1048, 1049, 1050,
        1051, 1052, 1053, 1054, 1055, 1056, 1057, 1058, 1059, 1060, 1061,
        1062, 1063, 1064, 1065, 1066, 1067, 1068, 1069, 1070, 1071, 1072,
        1073, 1074, 1075, 1076, 1077, 1078, 1079, 1080, 1081, 1082, 1083,
        1084, 1085, 1086, 1087, 1088, 1089, 1090, 1091, 1092, 1093, 1094,
        1095, 1096, 1097, 1098, 1099, 1100, 1101, 1102, 1103, 1104, 1105,
        1106, 1107, 1108, 1109, 1110, 1111, 1112, 1113, 1114, 1115, 1116,
        1117, 1118, 1119, 1120, 1121, 1122, 1123, 1124, 1125, 1126, 1127,
        1128, 1129, 1130, 1131, 1132, 1133, 1134, 1135, 1136, 1137, 1138,
        1139, 1140, 1141, 1142, 1143, 1144, 1145, 1146, 1147, 1148, 1149,
        1150, 1151, 1152, 1153, 1154, 1155, 1156, 1157, 1158, 1159, 1160,
        1161, 1162, 1163, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171,
        1172, 1173, 1174, 1175, 1176, 1177, 1178, 1179, 1180, 1181, 1182,
        1183, 1184, 1185, 1186, 1187, 1188, 1189, 1190, 1191, 1192, 1193,
        1194, 1195, 1196, 1197, 1198, 1199, 1400, 1401, 1402, 1403, 1404,
        1405, 1406, 1407, 1408, 1409, 1410, 1411, 1412, 1413, 1414, 1415,
        1416, 1417, 1418, 1419, 1420, 1421, 1422, 1423, 1424, 1425, 1426,
        1427, 1428, 1429, 1430, 1431, 1432, 1433, 1434, 1435, 1436, 1437,
        1438, 1439, 1440, 1441, 1442, 1443, 1444, 1445, 1446, 1447, 1448,
        1449, 1450, 1451, 1452, 1453, 1454, 1455, 1456, 1457, 1458, 1459,
        1460, 1461, 1462, 1463, 1464, 1465, 1466, 1467, 1468, 1469, 1470,
        1471, 1472, 1473, 1474, 1475, 1476, 1477, 1478, 1479, 1480, 1481,
        1482, 1483, 1484, 1485, 1486, 1487, 1488, 1489, 1490, 1491, 1492,
        1493, 1494, 1495, 1496, 1497, 1498, 1499, 1500, 1501, 1502, 1503,
        1504, 1505, 1506, 1507, 1508, 1509, 1510, 1511, 1512, 1513, 1514,
        1515, 1516, 1517, 1518, 1519, 1520, 1521, 1522, 1523, 1524, 1525,
        1526, 1527, 1528, 1529, 1530, 1531, 1532, 1533, 1534, 1535, 1536,
        1537, 1538, 1539, 1540, 1541, 1542, 1543, 1544, 1545, 1546, 1547,
        1548, 1549, 1550, 1551, 1552, 1553, 1554, 1555, 1556, 1557, 1558,
        1559, 1560, 1561, 1562, 1563, 1564, 1565, 1566, 1567, 1568, 1569,
        1570, 1571, 1572, 1573, 1574, 1575, 1576, 1577, 1578, 1579, 1580,
        1581, 1582, 1583, 1584, 1585, 1586, 1587, 1588, 1589, 1590, 1591,
        1592, 1593, 1594, 1595, 1596, 1597, 1598, 1599, 1800, 1801, 1802,
        1803, 1804, 1805, 1806, 1807, 1808, 1809, 1810, 1811, 1812, 1813,
        1814, 1815, 1816, 1817, 1818, 1819, 1820, 1821, 1822, 1823, 1824,
        1825, 1826, 1827, 1828, 1829, 1830, 1831, 1832, 1833, 1834, 1835,
        1836, 1837, 1838, 1839, 1840, 1841, 1842, 1843, 1844, 1845, 1846,
        1847, 1848, 1849, 1850, 1851, 1852, 1853, 1854, 1855, 1856, 1857,
        1858, 1859, 1860, 1861, 1862, 1863, 1864, 1865, 1866, 1867, 1868,
        1869, 1870, 1871, 1872, 1873, 1874, 1875, 1876, 1877, 1878, 1879,
        1880, 1881, 1882, 1883, 1884, 1885, 1886, 1887, 1888, 1889, 1890,
        1891, 1892, 1893, 1894, 1895, 1896, 1897, 1898, 1899, 1900, 1901,
        1902, 1903, 1904, 1905, 1906, 1907, 1908, 1909, 1910, 1911, 1912,
        1913, 1914, 1915, 1916, 1917, 1918, 1919, 1920, 1921, 1922, 1923,
        1924, 1925, 1926, 1927, 1928, 1929, 1930, 1931, 1932, 1933, 1934,
        1935, 1936, 1937, 1938, 1939, 1940, 1941, 1942, 1943, 1944, 1945,
        1946, 1947, 1948, 1949, 1950, 1951, 1952, 1953, 1954, 1955, 1956,
        1957, 1958, 1959, 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967,
        1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978,
        1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989,
        1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999]),)
</pre></div>
</div>
</div>
</div>
<p>We are not so interested in this tuple of length one; instead we are interested in the NumPy array it holds.  That NumPy array contains the indices where <code class="docutils literal notranslate"><span class="pre">BM</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">BM</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 200,  201,  202,  203,  204,  205,  206,  207,  208,  209,  210,
        211,  212,  213,  214,  215,  216,  217,  218,  219,  220,  221,
        222,  223,  224,  225,  226,  227,  228,  229,  230,  231,  232,
        233,  234,  235,  236,  237,  238,  239,  240,  241,  242,  243,
        244,  245,  246,  247,  248,  249,  250,  251,  252,  253,  254,
        255,  256,  257,  258,  259,  260,  261,  262,  263,  264,  265,
        266,  267,  268,  269,  270,  271,  272,  273,  274,  275,  276,
        277,  278,  279,  280,  281,  282,  283,  284,  285,  286,  287,
        288,  289,  290,  291,  292,  293,  294,  295,  296,  297,  298,
        299,  300,  301,  302,  303,  304,  305,  306,  307,  308,  309,
        310,  311,  312,  313,  314,  315,  316,  317,  318,  319,  320,
        321,  322,  323,  324,  325,  326,  327,  328,  329,  330,  331,
        332,  333,  334,  335,  336,  337,  338,  339,  340,  341,  342,
        343,  344,  345,  346,  347,  348,  349,  350,  351,  352,  353,
        354,  355,  356,  357,  358,  359,  360,  361,  362,  363,  364,
        365,  366,  367,  368,  369,  370,  371,  372,  373,  374,  375,
        376,  377,  378,  379,  380,  381,  382,  383,  384,  385,  386,
        387,  388,  389,  390,  391,  392,  393,  394,  395,  396,  397,
        398,  399,  600,  601,  602,  603,  604,  605,  606,  607,  608,
        609,  610,  611,  612,  613,  614,  615,  616,  617,  618,  619,
        620,  621,  622,  623,  624,  625,  626,  627,  628,  629,  630,
        631,  632,  633,  634,  635,  636,  637,  638,  639,  640,  641,
        642,  643,  644,  645,  646,  647,  648,  649,  650,  651,  652,
        653,  654,  655,  656,  657,  658,  659,  660,  661,  662,  663,
        664,  665,  666,  667,  668,  669,  670,  671,  672,  673,  674,
        675,  676,  677,  678,  679,  680,  681,  682,  683,  684,  685,
        686,  687,  688,  689,  690,  691,  692,  693,  694,  695,  696,
        697,  698,  699,  700,  701,  702,  703,  704,  705,  706,  707,
        708,  709,  710,  711,  712,  713,  714,  715,  716,  717,  718,
        719,  720,  721,  722,  723,  724,  725,  726,  727,  728,  729,
        730,  731,  732,  733,  734,  735,  736,  737,  738,  739,  740,
        741,  742,  743,  744,  745,  746,  747,  748,  749,  750,  751,
        752,  753,  754,  755,  756,  757,  758,  759,  760,  761,  762,
        763,  764,  765,  766,  767,  768,  769,  770,  771,  772,  773,
        774,  775,  776,  777,  778,  779,  780,  781,  782,  783,  784,
        785,  786,  787,  788,  789,  790,  791,  792,  793,  794,  795,
        796,  797,  798,  799, 1000, 1001, 1002, 1003, 1004, 1005, 1006,
       1007, 1008, 1009, 1010, 1011, 1012, 1013, 1014, 1015, 1016, 1017,
       1018, 1019, 1020, 1021, 1022, 1023, 1024, 1025, 1026, 1027, 1028,
       1029, 1030, 1031, 1032, 1033, 1034, 1035, 1036, 1037, 1038, 1039,
       1040, 1041, 1042, 1043, 1044, 1045, 1046, 1047, 1048, 1049, 1050,
       1051, 1052, 1053, 1054, 1055, 1056, 1057, 1058, 1059, 1060, 1061,
       1062, 1063, 1064, 1065, 1066, 1067, 1068, 1069, 1070, 1071, 1072,
       1073, 1074, 1075, 1076, 1077, 1078, 1079, 1080, 1081, 1082, 1083,
       1084, 1085, 1086, 1087, 1088, 1089, 1090, 1091, 1092, 1093, 1094,
       1095, 1096, 1097, 1098, 1099, 1100, 1101, 1102, 1103, 1104, 1105,
       1106, 1107, 1108, 1109, 1110, 1111, 1112, 1113, 1114, 1115, 1116,
       1117, 1118, 1119, 1120, 1121, 1122, 1123, 1124, 1125, 1126, 1127,
       1128, 1129, 1130, 1131, 1132, 1133, 1134, 1135, 1136, 1137, 1138,
       1139, 1140, 1141, 1142, 1143, 1144, 1145, 1146, 1147, 1148, 1149,
       1150, 1151, 1152, 1153, 1154, 1155, 1156, 1157, 1158, 1159, 1160,
       1161, 1162, 1163, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171,
       1172, 1173, 1174, 1175, 1176, 1177, 1178, 1179, 1180, 1181, 1182,
       1183, 1184, 1185, 1186, 1187, 1188, 1189, 1190, 1191, 1192, 1193,
       1194, 1195, 1196, 1197, 1198, 1199, 1400, 1401, 1402, 1403, 1404,
       1405, 1406, 1407, 1408, 1409, 1410, 1411, 1412, 1413, 1414, 1415,
       1416, 1417, 1418, 1419, 1420, 1421, 1422, 1423, 1424, 1425, 1426,
       1427, 1428, 1429, 1430, 1431, 1432, 1433, 1434, 1435, 1436, 1437,
       1438, 1439, 1440, 1441, 1442, 1443, 1444, 1445, 1446, 1447, 1448,
       1449, 1450, 1451, 1452, 1453, 1454, 1455, 1456, 1457, 1458, 1459,
       1460, 1461, 1462, 1463, 1464, 1465, 1466, 1467, 1468, 1469, 1470,
       1471, 1472, 1473, 1474, 1475, 1476, 1477, 1478, 1479, 1480, 1481,
       1482, 1483, 1484, 1485, 1486, 1487, 1488, 1489, 1490, 1491, 1492,
       1493, 1494, 1495, 1496, 1497, 1498, 1499, 1500, 1501, 1502, 1503,
       1504, 1505, 1506, 1507, 1508, 1509, 1510, 1511, 1512, 1513, 1514,
       1515, 1516, 1517, 1518, 1519, 1520, 1521, 1522, 1523, 1524, 1525,
       1526, 1527, 1528, 1529, 1530, 1531, 1532, 1533, 1534, 1535, 1536,
       1537, 1538, 1539, 1540, 1541, 1542, 1543, 1544, 1545, 1546, 1547,
       1548, 1549, 1550, 1551, 1552, 1553, 1554, 1555, 1556, 1557, 1558,
       1559, 1560, 1561, 1562, 1563, 1564, 1565, 1566, 1567, 1568, 1569,
       1570, 1571, 1572, 1573, 1574, 1575, 1576, 1577, 1578, 1579, 1580,
       1581, 1582, 1583, 1584, 1585, 1586, 1587, 1588, 1589, 1590, 1591,
       1592, 1593, 1594, 1595, 1596, 1597, 1598, 1599, 1800, 1801, 1802,
       1803, 1804, 1805, 1806, 1807, 1808, 1809, 1810, 1811, 1812, 1813,
       1814, 1815, 1816, 1817, 1818, 1819, 1820, 1821, 1822, 1823, 1824,
       1825, 1826, 1827, 1828, 1829, 1830, 1831, 1832, 1833, 1834, 1835,
       1836, 1837, 1838, 1839, 1840, 1841, 1842, 1843, 1844, 1845, 1846,
       1847, 1848, 1849, 1850, 1851, 1852, 1853, 1854, 1855, 1856, 1857,
       1858, 1859, 1860, 1861, 1862, 1863, 1864, 1865, 1866, 1867, 1868,
       1869, 1870, 1871, 1872, 1873, 1874, 1875, 1876, 1877, 1878, 1879,
       1880, 1881, 1882, 1883, 1884, 1885, 1886, 1887, 1888, 1889, 1890,
       1891, 1892, 1893, 1894, 1895, 1896, 1897, 1898, 1899, 1900, 1901,
       1902, 1903, 1904, 1905, 1906, 1907, 1908, 1909, 1910, 1911, 1912,
       1913, 1914, 1915, 1916, 1917, 1918, 1919, 1920, 1921, 1922, 1923,
       1924, 1925, 1926, 1927, 1928, 1929, 1930, 1931, 1932, 1933, 1934,
       1935, 1936, 1937, 1938, 1939, 1940, 1941, 1942, 1943, 1944, 1945,
       1946, 1947, 1948, 1949, 1950, 1951, 1952, 1953, 1954, 1955, 1956,
       1957, 1958, 1959, 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967,
       1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978,
       1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989,
       1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999])
</pre></div>
</div>
</div>
</div>
<p>Let’s save that NumPy array with the variable name <code class="docutils literal notranslate"><span class="pre">inds</span></code>, for “indices”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">BM</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>It’s worth thinking slowly about why the following works.  We want to know all the indices <code class="docutils literal notranslate"><span class="pre">x</span></code> in <code class="docutils literal notranslate"><span class="pre">inds</span></code> such that <code class="docutils literal notranslate"><span class="pre">x-1</span></code> is not in <code class="docutils literal notranslate"><span class="pre">inds</span></code>, because that means that at index <code class="docutils literal notranslate"><span class="pre">x</span></code>, we switched between colors.  Here is how we can get those indices using list comprehension.  If you look through the previous array of indices, you’ll notice that <code class="docutils literal notranslate"><span class="pre">600</span></code> is in the array, but <code class="docutils literal notranslate"><span class="pre">599</span></code> is not in the array, so the pixels at index <code class="docutils literal notranslate"><span class="pre">599</span></code> and <code class="docutils literal notranslate"><span class="pre">600</span></code> have different colors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inds</span> <span class="k">if</span> <span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[200, 600, 1000, 1400, 1800]
</pre></div>
</div>
</div>
</div>
<p>If you look at <code class="docutils literal notranslate"><span class="pre">img</span></code> with the knowledge that it is total width 2000 pixels, so each square might be width 200, it makes sense that the colors switch from the yellow-ish color to the green-ish color at positions 200, 600, 1000, 1400, 1800.  The above list of numbers confirms this guess.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_197_0.png" src="../_images/Pillow_197_0.png" />
</div>
</div>
</section>
<section id="changing-colors-using-a-boolean-mask">
<h2>Changing colors using a Boolean mask<a class="headerlink" href="#changing-colors-using-a-boolean-mask" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/gFxxUQ311K8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Changing triples of values in a NumPy array is significantly harder than changing individual values.  Here is our goal in this section.</p>
<ul class="simple">
<li><p>Replace all [12, 12, 12] RGB triples with [0, 255, 255] using a Boolean mask.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>We will use the same grid as in the previous section.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;images/test_grid.png&quot;</span><span class="p">)</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To motivate our approach, we are going to start with a smaller example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Recall how <em>Boolean masking</em> (which I also call <em>Boolean indexing</em>) works.  For example, if we want to get exactly the values of <code class="docutils literal notranslate"><span class="pre">A</span></code> which are strictly greater than <code class="docutils literal notranslate"><span class="pre">5</span></code>, we can first form the following Boolean array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ True, False, False, False, False, False, False, False, False,
        True, False,  True])
</pre></div>
</div>
</div>
</div>
<p>And then we can “apply this Boolean mask” by evaluating <code class="docutils literal notranslate"><span class="pre">A[A</span> <span class="pre">&gt;</span> <span class="pre">5]</span></code>.  This will keep those values of <code class="docutils literal notranslate"><span class="pre">A</span></code> which are in slots containing <code class="docutils literal notranslate"><span class="pre">True</span></code> in our Boolean mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 9, 10,  8])
</pre></div>
</div>
</div>
</div>
<p>If we instead want to keep pairs satisfying a certain condition, the situation is a little more complicated.</p>
<p>I don’t like the way <code class="docutils literal notranslate"><span class="pre">B</span></code> is displayed by NumPy.  It would be better to think of it as a 2-row by 3-column matrix, each entry of which is a pair of numbers.  (In our actual example, the “pair of numbers” portion will be replaced by an RGB triple.)</p>
<p>Here is how I would visualize <code class="docutils literal notranslate"><span class="pre">B</span></code>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}
[9,2] &amp; [4,5] &amp; [1,1] \\
[1,0] &amp; [2,10] &amp; [5,8]
\end{pmatrix}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">B</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[ 9,  2],
        [ 4,  5],
        [ 1,  1]],

       [[ 1,  0],
        [ 2, 10],
        [ 5,  8]]])
</pre></div>
</div>
</div>
</div>
<p>Say we want to find all the pairs of numbers whose sum is strictly greater than 5.  If we just call <code class="docutils literal notranslate"><span class="pre">B.sum()</span></code>, that adds together all the numbers in <code class="docutils literal notranslate"><span class="pre">B</span></code>, which isn’t what we want.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>48
</pre></div>
</div>
</div>
</div>
<p>As usual, we can include an <code class="docutils literal notranslate"><span class="pre">axis</span></code> keyword argument.  In this case, we want to add up the last axis, <code class="docutils literal notranslate"><span class="pre">axis=2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[11,  9,  2],
       [ 1, 12, 13]])
</pre></div>
</div>
</div>
</div>
<p>From here we can create a Boolean array just like before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ True,  True, False],
       [False,  True,  True]])
</pre></div>
</div>
</div>
</div>
<p>But what should be the result of indexing using this Boolean mask?  It turns out that the 2-by-3 shape of <code class="docutils literal notranslate"><span class="pre">B</span></code> is completely lost, and the pairs satisfying the condition are listed as rows, one on top of the other.  (This surprised me at first, but if you think about it, what better convention can you come up with?  Keeping the shape the same and leaving the <code class="docutils literal notranslate"><span class="pre">False</span></code> slots blank would not be an allowable NumPy array.)</p>
<p>Anyway, here is the result of applying this Boolean mask.  Be sure you understand how it relates to <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="n">B</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 9,  2],
       [ 4,  5],
       [ 2, 10],
       [ 5,  8]])
</pre></div>
</div>
</div>
</div>
<p>If we want to change the elements satisfying this condition, as opposed to displaying the elements, then the shape can be retained.  (The old values are left unchanged in the <code class="docutils literal notranslate"><span class="pre">False</span></code> slots.)  For example, here we replace all the pairs which have sum strictly greater than <code class="docutils literal notranslate"><span class="pre">5</span></code> with the pair <code class="docutils literal notranslate"><span class="pre">[-4,-5]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="n">B</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The shape is a little concealed by the way NumPy displays it.  Here is a clearer visualization of the shape:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}
[-4,-5] &amp; [-4,-5] &amp; [1,1] \\
[1,0] &amp; [-4,-5] &amp; [-4,-5]
\end{pmatrix}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[-4, -5],
        [-4, -5],
        [ 1,  1]],

       [[ 1,  0],
        [-4, -5],
        [-4, -5]]])
</pre></div>
</div>
</div>
</div>
<p>Once the above example makes perfect sense, our image processing example will be much easier to follow.  Recall our goal:</p>
<ul class="simple">
<li><p>Replace all [12, 12, 12] RGB triples with [0, 255, 255] using a Boolean mask.</p></li>
</ul>
<p>In the following print-out, we can’t see any <code class="docutils literal notranslate"><span class="pre">[12,</span> <span class="pre">12,</span> <span class="pre">12]</span></code> triples, so none of the following displayed pixels should be changed.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       [[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       [[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       ...,

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]],

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]],

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>We create a two-dimensional Boolean mask using <code class="docutils literal notranslate"><span class="pre">all(axis=2)</span></code>, similar to the previous section.  Again, all of the displayed values are <code class="docutils literal notranslate"><span class="pre">False</span></code>, so none of the displayed pixels should be changed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       ...,
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False]])
</pre></div>
</div>
</div>
</div>
<p>If we use Boolean indexing, we get the triples which satisfy the condition listed one on top of each other, just like above when we used Boolean indexing with <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[(</span><span class="n">arr</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[12, 12, 12],
       [12, 12, 12],
       [12, 12, 12],
       ...,
       [12, 12, 12],
       [12, 12, 12],
       [12, 12, 12]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>How many pixels have RGB values <code class="docutils literal notranslate"><span class="pre">[12,</span> <span class="pre">12,</span> <span class="pre">12]</span></code>?  A lot, nearly 500,000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[(</span><span class="n">arr</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(467679, 3)
</pre></div>
</div>
</div>
</div>
<p>Our usual “read-only” error shows up in this context, but our NumPy strategy itself is correct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span><span class="p">[(</span><span class="n">arr</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">Input In [17],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">arr</span><span class="p">[(</span><span class="n">arr</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>

<span class="ne">ValueError</span>: assignment destination is read-only
</pre></div>
</div>
</div>
</div>
<p>As usual, we create a NumPy array which is not read-only by using the <code class="docutils literal notranslate"><span class="pre">copy</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">[(</span><span class="n">C</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The fun thing about using image processing as our example is that we can display the results at the end in a visual manner.  Here is the result of replacing all of the <code class="docutils literal notranslate"><span class="pre">[12,</span> <span class="pre">12,</span> <span class="pre">12]</span></code> pixels, which are close to black, with <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">255,</span> <span class="pre">255]</span></code> pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_236_0.png" src="../_images/Pillow_236_0.png" />
</div>
</div>
</section>
<section id="changing-colors-using-np-where">
<h2>Changing colors using <code class="docutils literal notranslate"><span class="pre">np.where</span></code><a class="headerlink" href="#changing-colors-using-np-where" title="Permalink to this headline">#</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3xf0YzJmnQE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>In the previous section, we replaced the black text with a single blue-ish color.  Here we are going to replace the square backgrounds with different random colors.  In the previous section, we used Boolean indexing (which I also call a Boolean mask).  I don’t know how to accomplish the goal of this section using Boolean indexing; in this section we will use <code class="docutils literal notranslate"><span class="pre">np.where</span></code>.</p>
<p>Here is the overall goal for this section.</p>
<ul class="simple">
<li><p>Replace the square backgrounds with random colors.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;images/test_grid.png&quot;</span><span class="p">)</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We are going to use the function <code class="docutils literal notranslate"><span class="pre">np.where</span></code> to replace the square background colors.  This function is a little complicated, but it is also very powerful.  Let’s start out with seeing a basic application of this function, applied on a one-dimensional NumPy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Consider the following example.  The first argument to <code class="docutils literal notranslate"><span class="pre">np.where</span></code> is a Boolean array, and the next two arguments are numbers, <code class="docutils literal notranslate"><span class="pre">-20</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span></code>.  What this does is replace each <code class="docutils literal notranslate"><span class="pre">True</span></code> in the Boolean array with <code class="docutils literal notranslate"><span class="pre">-20</span></code> and replace each <code class="docutils literal notranslate"><span class="pre">False</span></code> in the Boolean array with <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-20,   3,   3,   3,   3,   3,   3,   3,   3, -20,   3, -20])
</pre></div>
</div>
</div>
</div>
<p>That seems easy enough; here is a more sophisticated example.  Instead of passing <code class="docutils literal notranslate"><span class="pre">-20</span></code> as our <code class="docutils literal notranslate"><span class="pre">True</span></code> replacement, we pass the entire array <code class="docutils literal notranslate"><span class="pre">A</span></code>.  Notice that <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&gt;</span> <span class="pre">5</span></code> and <code class="docutils literal notranslate"><span class="pre">A</span></code> have the same shape.  In this case, the values of <code class="docutils literal notranslate"><span class="pre">True</span></code> get replaced by the corresponding value in <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 9,  3,  3,  3,  3,  3,  3,  3,  3, 10,  3,  8])
</pre></div>
</div>
</div>
</div>
<p>There was nothing special about using <code class="docutils literal notranslate"><span class="pre">A</span></code> itself in the previous example.  Any array of that shape would have worked exactly the same.  For example, here we use <code class="docutils literal notranslate"><span class="pre">100*A</span></code>, and so the initial <code class="docutils literal notranslate"><span class="pre">True</span></code> gets replaced by <span class="math notranslate nohighlight">\(900 = 100 \cdot 9\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">A</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 900,    3,    3,    3,    3,    3,    3,    3,    3, 1000,    3,
        800])
</pre></div>
</div>
</div>
</div>
<p>We can also replace the <code class="docutils literal notranslate"><span class="pre">False</span></code> replacement with an array.  Here we use an <code class="docutils literal notranslate"><span class="pre">np.arange</span></code>.  Notice how we ensure it has the same length as <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">A</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 900,    1,    2,    3,    4,    5,    6,    7,    8, 1000,   10,
        800])
</pre></div>
</div>
</div>
</div>
<p>That is most (but not all) of the information we need about <code class="docutils literal notranslate"><span class="pre">np.where</span></code> to replace the square background images.  Let’s remind ourselves what the original image looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_251_0.png" src="../_images/Pillow_251_0.png" />
</div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">np.where</span></code>, the first argument should be some Boolean array.  It seems easier to find the black colors than to find the background colors (because there is only one black color but there are two background colors).  Since <code class="docutils literal notranslate"><span class="pre">np.where</span></code> replaces both the <code class="docutils literal notranslate"><span class="pre">True</span></code> values and the <code class="docutils literal notranslate"><span class="pre">False</span></code> values, it doesn’t really matter if we are using <code class="docutils literal notranslate"><span class="pre">mask</span></code> or <code class="docutils literal notranslate"><span class="pre">~mask</span></code> in the following; we would just need to swap the following inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In NumPy’s preview display of <code class="docutils literal notranslate"><span class="pre">mask</span></code>, all of the values are <code class="docutils literal notranslate"><span class="pre">False</span></code>.  That is because there are no black pixels in the top 3 rows nor in the bottom 3 rows of <code class="docutils literal notranslate"><span class="pre">img</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       ...,
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False],
       [False, False, False, ..., False, False, False]])
</pre></div>
</div>
</div>
</div>
<p>Let’s try something simple (no replacing of colors).  Let’s just pass <code class="docutils literal notranslate"><span class="pre">arr</span></code> for both the <code class="docutils literal notranslate"><span class="pre">True</span></code> replacement as well as the <code class="docutils literal notranslate"><span class="pre">False</span></code> replacement.  Try reading the error message we get, and see if you can tell what the problem is.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">Input In [11],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>

<span class="nn">File &lt;__array_function__ internals&gt;:180,</span> in <span class="ni">where</span><span class="nt">(*args, **kwargs)</span>

<span class="ne">ValueError</span>: operands could not be broadcast together with shapes (2000,2000) (2000,2000,3) (2000,2000,3) 
</pre></div>
</div>
</div>
</div>
<p>In our earlier example, <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&gt;</span> <span class="pre">5</span></code> had the exact same shape as <code class="docutils literal notranslate"><span class="pre">100*A</span></code> and as <code class="docutils literal notranslate"><span class="pre">np.arange(len(A))</span></code>.  In our example here, <code class="docutils literal notranslate"><span class="pre">mask</span></code> does not have the same shape as <code class="docutils literal notranslate"><span class="pre">arr</span></code>.  There is no hope of using <code class="docutils literal notranslate"><span class="pre">reshape</span></code> on <code class="docutils literal notranslate"><span class="pre">mask</span></code> to get it into shape <code class="docutils literal notranslate"><span class="pre">(2000,</span> <span class="pre">2000,</span> <span class="pre">3)</span></code>, but we don’t actually need them to have the same shape.  Instead, we just need them to be <em>broadcastable</em> to the same shape.</p>
<p>As it stands, the final (right-most) dimensions (2000 and 3) are not compatible in terms of broadcasting, but we can fix that easily by adding a new dimension of size <code class="docutils literal notranslate"><span class="pre">1</span></code> at the end of <code class="docutils literal notranslate"><span class="pre">mask</span></code>.  We add this third dimension using <code class="docutils literal notranslate"><span class="pre">reshape</span></code>.  (Aside: In the following, typing <code class="docutils literal notranslate"><span class="pre">2000</span></code> twice does not feel very robust.  I would rather type something involving <code class="docutils literal notranslate"><span class="pre">arr</span></code>.  Can you find a better approach?)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The output of the following is not so important. (The output should be identical to <code class="docutils literal notranslate"><span class="pre">arr</span></code>; can you check that using <code class="docutils literal notranslate"><span class="pre">all</span></code>?)  More what I wanted to see is that the following does not raise an error, so the shapes are indeed compatible.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       [[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       [[180, 153,  12],
        [180, 153,  12],
        [180, 153,  12],
        ...,
        [ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152]],

       ...,

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]],

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]],

       [[ 12, 153, 152],
        [ 12, 153, 152],
        [ 12, 153, 152],
        ...,
        [180, 153,  12],
        [180, 153,  12],
        [180, 153,  12]]], dtype=uint8)
</pre></div>
</div>
</div>
</div>
<p>Now that we have our template, let’s work on the <code class="docutils literal notranslate"><span class="pre">False</span></code> replacements (i.e., the background color replacements).  We want random background colors, so let’s start by instantiating a NumPy random number generator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Our colors correspond to RGB triples, with integers between 0 and 255 (inclusive).  We want a 10-by-10 grid of random colors, so we will use shape <code class="docutils literal notranslate"><span class="pre">(10,10,3)</span></code>; think of this as a 10-by-10 matrix of random RGB values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We saw a few sections ago that every square has side-length 200, so we are going to repeat each color <code class="docutils literal notranslate"><span class="pre">200</span></code> times.  We will use the <code class="docutils literal notranslate"><span class="pre">repeat</span></code> method, which accepts an axis argument to say which axis to repeat along; we will repeat along both <code class="docutils literal notranslate"><span class="pre">axis=0</span></code> and <code class="docutils literal notranslate"><span class="pre">axis=1</span></code>.</p>
<p>Another way to think about this, is that we eventually want something broadcastable to shape <code class="docutils literal notranslate"><span class="pre">(2000,</span> <span class="pre">2000,</span> <span class="pre">3)</span></code>, and our <code class="docutils literal notranslate"><span class="pre">colors</span></code> variable has shape <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">10,</span> <span class="pre">3)</span></code>, so it is natural to repeat <code class="docutils literal notranslate"><span class="pre">200</span></code> times in the rows and the columns dimensions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice how we can see that colors are now getting repeated.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[182, 207, 208],
        [182, 207, 208],
        [182, 207, 208],
        ...,
        [ 69, 118, 212],
        [ 69, 118, 212],
        [ 69, 118, 212]],

       [[182, 207, 208],
        [182, 207, 208],
        [182, 207, 208],
        ...,
        [ 69, 118, 212],
        [ 69, 118, 212],
        [ 69, 118, 212]],

       [[182, 207, 208],
        [182, 207, 208],
        [182, 207, 208],
        ...,
        [ 69, 118, 212],
        [ 69, 118, 212],
        [ 69, 118, 212]],

       ...,

       [[231, 209, 153],
        [231, 209, 153],
        [231, 209, 153],
        ...,
        [111, 105,  86],
        [111, 105,  86],
        [111, 105,  86]],

       [[231, 209, 153],
        [231, 209, 153],
        [231, 209, 153],
        ...,
        [111, 105,  86],
        [111, 105,  86],
        [111, 105,  86]],

       [[231, 209, 153],
        [231, 209, 153],
        [231, 209, 153],
        ...,
        [111, 105,  86],
        [111, 105,  86],
        [111, 105,  86]]])
</pre></div>
</div>
</div>
</div>
<p>Recall that <code class="docutils literal notranslate"><span class="pre">colors</span></code> had shape <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">10,</span> <span class="pre">3)</span></code>; we passed that tuple explicitly to <code class="docutils literal notranslate"><span class="pre">rng.integers</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10, 10, 3)
</pre></div>
</div>
</div>
</div>
<p>After our repetitions, <code class="docutils literal notranslate"><span class="pre">Y</span></code> now has shape <code class="docutils literal notranslate"><span class="pre">(2000,</span> <span class="pre">2000,</span> <span class="pre">3)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2000, 2000, 3)
</pre></div>
</div>
</div>
</div>
<p>The NumPy array <code class="docutils literal notranslate"><span class="pre">Y</span></code> contains what we are going to use to replace the <code class="docutils literal notranslate"><span class="pre">False</span></code> values with (<code class="docutils literal notranslate"><span class="pre">True</span></code> corresponded to the black colors, and <code class="docutils literal notranslate"><span class="pre">False</span></code> corresponded to the other two cololrs).  So <code class="docutils literal notranslate"><span class="pre">Y</span></code> is the final argument to <code class="docutils literal notranslate"><span class="pre">np.where</span></code>.  The only other thing we need to do, to get an image out of this, is to make sure it has the correct <code class="docutils literal notranslate"><span class="pre">dtype</span></code> of unsigned 8-bit integers.  We do that here using the <code class="docutils literal notranslate"><span class="pre">astype</span></code> argument.  (Another option, which we used before, would be to do this in two steps, where the second step is setting the <code class="docutils literal notranslate"><span class="pre">dtype</span></code>.)</p>
<p>Here is the resulting image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Pillow_275_0.png" src="../_images/Pillow_275_0.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Week4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Week4-Intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Week 4</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="ObjectOriented.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Brief introduction to object-oriented programming</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Christopher Davis<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>